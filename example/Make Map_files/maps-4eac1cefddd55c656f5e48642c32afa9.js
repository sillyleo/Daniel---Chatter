LeafIcon=L.Icon.extend({options:{iconSize:[64,64]}}),function(n){var a,o,t,e,i,l,r;if(n.params=[],r=location.search,-1!==r.indexOf("?"))for(o=void 0,a=void 0,t=r.split("?"),o=t[1].split("&"),e=0;e<o.length;)a=o[e].split("="),params.push(a[0]),params[a[0]]=a[1],e++;i=L.tileLayer("http://otile{s}.mqcdn.com/tiles/1.0.0/map/{z}/{x}/{y}.jpeg",{subdomains:"1234"}),n.taiwanCenter=new L.LatLng(23.974093,120.979903),n.map=new L.Map("map",{layers:i,center:taiwanCenter,zoom:8,minZoom:4}),n.otherIcon=new LeafIcon({iconUrl:"/images/singing.png"}),n.paintingIcon=new LeafIcon({iconUrl:"/images/painting.png"}),L.Icon.Default.imagePath="/images/leaflet/images",n.myIcon=new L.Icon.Default,n.setMarkerOnMapArea=function(n,a,o){n.setLatLng(a),map.setView(a),"undefined"!=typeof o&&o.call(this,a)},n.setLocationNumfunction=function(n){var a;a=$("#location_lat"),a.length&&($("#location_lat").val(n.lat),$("#location_lng").val(n.lng))},L.control.locate().addTo(map),l=function(a){return setMarkerOnMapArea(n.myMarker,a.latlng,setLocationNumfunction)},map.on("locationfound",l),n.get_marker_and_pin_in_map=function(n,a){$.ajax({url:"/maps/"+n+"/locations",dataType:"json",success:function(o){var t=new L.MarkerClusterGroup,e=Object.keys(o);for(var i in e)if(o[e[i]].lat){var l={};l=o[e[i]].location_pin?new LeafIcon({iconUrl:o[e[i]].location_pin.pin.url}):otherIcon;var r=o[e[i]].title,c=o[e[i]].id,p=L.marker([o[e[i]].lat,o[e[i]].lng],{icon:l,location_id:c,title:r});t.addLayer(p);var s="<h2>"+o[e[i]].title+"</h2>";p.bindPopup(s),a(p,n)}map.addLayer(t),map.fitBounds(t.getBounds())}})};var c=location.href.split("/");n.map_url=c.slice(0,5).join("/")}(window);